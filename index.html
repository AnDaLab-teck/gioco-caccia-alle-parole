<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caccia alle Parole ü¶ä</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --color-primary: #4ecdc4; --color-secondary: #45b7d1; --color-accent: #ff6b6b; --color-success: #96ceb4; --color-text: #333; --color-light: #fff; --font-family: 'Fredoka', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); color: var(--color-text); display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #f5f7fa, #c3cfe2); padding: 1rem; }
        .game-container { width: 100%; max-width: 800px; background: rgba(255, 255, 255, 0.95); border-radius: 24px; padding: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transform: scale(0.95); opacity: 0; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { to { transform: scale(1); opacity: 1; } }
        .screen { display: none; }
        .screen.active { display: block; }
        #start-screen h1 { font-size: 3rem; text-align: center; background: linear-gradient(45deg, var(--color-primary), var(--color-accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 1rem; }
        #start-screen p { text-align: center; font-size: 1.2rem; margin-bottom: 2rem; color: #555; }
        .hud { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .hud-item { text-align: center; }
        .hud-label { font-size: .9rem; color: #777; }
        .hud-value { font-size: 1.5rem; font-weight: 700; }
        .progress-bar-container { width: 100%; height: 16px; background-color: #e0e0e0; border-radius: 8px; margin-bottom: 2rem; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); transition: width 0.5s ease-out; }
        #question-area { text-align: center; margin-bottom: 2rem; min-height: 120px; }
        .category-badge { display: inline-block; background-color: var(--color-primary); color: var(--color-light); padding: .3rem .8rem; border-radius: 20px; font-size: .9rem; margin-bottom: 1rem; }
        .word-display { font-size: 2.8rem; font-weight: 700; }
        #options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .option-btn { width: 100%; padding: 1.2rem; font-size: 1.1rem; font-family: var(--font-family); background-color: var(--color-light); border: 2px solid #ddd; border-radius: 12px; cursor: pointer; transition: all 0.2s ease; }
        .option-btn:hover:not(:disabled) { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-color: var(--color-primary); }
        .option-btn:disabled { cursor: not-allowed; }
        .option-btn.correct { background-color: var(--color-success); color: var(--color-light); border-color: var(--color-success); }
        .option-btn.incorrect { background-color: var(--color-accent); color: var(--color-light); border-color: var(--color-accent); }
        #end-screen { text-align: center; }
        #end-screen h2 { font-size: 2.5rem; margin-bottom: 1rem; }
        #final-score { font-size: 4rem; font-weight: 700; color: var(--color-primary); }
        .btn { padding: 1rem 2rem; font-size: 1.2rem; border: none; border-radius: 12px; cursor: pointer; transition: background-color 0.3s ease; background-color: var(--color-primary); color: #fff; }
        .btn:hover { background-color: var(--color-secondary); }
        #feedback-area { min-height: 40px; margin-top: 1.5rem; font-weight: 500; text-align: center; }
        @media (max-width: 768px) { #options-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="start-screen" class="screen active">
            <h1>Caccia alle Parole ü¶ä</h1>
            <p>Metti alla prova il tuo vocabolario! 10 domande per scoprire quante parole conosci. Sei pronto?</p>
            <button id="start-btn" class="btn">Inizia Partita! üöÄ</button>
        </div>
        <div id="game-screen" class="screen">
            <div class="hud">
                <div class="hud-item"><div class="hud-label">PUNTI</div><div id="hud-score" class="hud-value">0</div></div>
                <div class="hud-item"><div class="hud-label">DOMANDA</div><div id="hud-question-counter" class="hud-value">1 / 10</div></div>
                <div class="hud-item"><div class="hud-label">SERIE üî•</div><div id="hud-streak-value" class="hud-value">0</div></div>
            </div>
            <div class="progress-bar-container"><div id="progress-bar" class="progress-bar"></div></div>
            <div id="question-area"><div id="category-badge" class="category-badge"></div><h2 id="word-display" class="word-display"></h2></div>
            <div id="options-grid"></div>
            <div id="feedback-area"></div>
        </div>
        <div id="end-screen" class="screen">
            <h2>Partita Finita! üéâ</h2>
            <p>Il tuo punteggio finale √®:</p>
            <div id="final-score">0</div>
            <button id="restart-btn" class="btn">Nuova Partita üîÅ</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const startBtn = document.getElementById('start-btn');
            const restartBtn = document.getElementById('restart-btn');
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const endScreen = document.getElementById('end-screen');
            let usedWords = [];

            const fetchWord = async () => {
                wordDisplay.textContent = 'Sto pensando...';
                optionsGrid.innerHTML = '';
                try {
                    const response = await fetch('/api/getWord', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ difficulty: 1, usedWords: usedWords })
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    usedWords.push(data.word);
                    return data;
                } catch (error) {
                    console.error('Fetch error:', error);
                    wordDisplay.textContent = 'Errore: Impossibile generare la parola. Controlla la chiave API nelle impostazioni di Vercel e assicurati che il sito sia stato pubblicato correttamente.';
                    return null;
                }
            };

            const displayQuestion = async () => {
                const data = await fetchWord();
                if (data) {
                    wordDisplay.textContent = data.word;
                    categoryBadge.textContent = data.category;
                    const options = [data.correct, ...data.distractors].sort(() => Math.random() - 0.5);
                    options.forEach(optionText => {
                        const button = document.createElement('button');
                        button.className = 'option-btn';
                        button.textContent = optionText;
                        button.onclick = () => {
                            Array.from(optionsGrid.children).forEach(btn => btn.disabled = true);
                            if (optionText === data.correct) {
                                button.classList.add('correct');
                            } else {
                                button.classList.add('incorrect');
                            }
                        };
                        optionsGrid.appendChild(button);
                    });
                }
            };
            
            startBtn.addEventListener('click', () => {
                startScreen.classList.remove('active');
                gameScreen.classList.add('active');
                displayQuestion();
            });
        });
    </script>
</body>
</html>
